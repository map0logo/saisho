<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="App. A: Sequences and difference equations">

<title>App. A: Sequences and difference equations</title>


<style type="text/css">
/* bloodish style */

body {
  font-family: Helvetica, Verdana, Arial, Sans-serif;
  color: #404040;
  background: #ffffff;
}
h1 { font-size: 1.8em;  color: #8A0808; }
h2 { font-size: 1.6em;  color: #8A0808; }
h3 { font-size: 1.4em;  color: #8A0808; }
h4 { color: #8A0808; }
a { color: #8A0808; text-decoration:none; }
tt { font-family: "Courier New", Courier; }

p { text-indent: 0px; }
hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
p.caption { width: 80%; font-style: normal; text-align: left; }
hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
.alert-text-small   { font-size: 80%;  }
.alert-text-large   { font-size: 130%; }
.alert-text-normal  { font-size: 90%;  }
.alert {
  padding:8px 35px 8px 14px; margin-bottom:18px;
  text-shadow:0 1px 0 rgba(255,255,255,0.5);
  border:1px solid #bababa;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  color: #555;
  background-color: #f8f8f8;
  background-position: 10px 5px;
  background-repeat: no-repeat;
  background-size: 38px;
  padding-left: 55px;
  width: 75%;
 }
.alert-block {padding-top:14px; padding-bottom:14px}
.alert-block > p, .alert-block > ul {margin-bottom:1em}
.alert li {margin-top: 1em}
.alert-block p+p {margin-top:5px}
.alert-notice { background-image: url(https://raw.github.com/hplgit/doconce/master/bundled/html_images/small_gray_notice.png); }
.alert-summary  { background-image:url(https://raw.github.com/hplgit/doconce/master/bundled/html_images/small_gray_summary.png); }
.alert-warning { background-image: url(https://raw.github.com/hplgit/doconce/master/bundled/html_images/small_gray_warning.png); }
.alert-question {background-image:url(https://raw.github.com/hplgit/doconce/master/bundled/html_images/small_gray_question.png); }

div { text-align: justify; text-justify: inter-word; }
</style>


</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [(u' Sequences ', 2, None, '___sec0'),
              (u' Other examples of sequences ', 2, None, '___sec1'),
              (u' Finite and infinite sequences ', 2, None, '___sec2'),
              (u' Difference equations ', 2, None, '___sec3'),
              (u' Modeling interest rates ', 2, None, '___sec4'),
              (u' Simulating the difference equation for interest rates ',
               2,
               None,
               '___sec5'),
              (u' We do not need to store the entire sequence, but it is convenient for programming and later plotting ',
               2,
               None,
               '___sec6'),
              (u' Daily interest rate ', 2, None, '___sec7'),
              (u' Program for daily interest rate ', 2, None, '___sec8'),
              (u' But the annual interest rate may change quite often... ',
               2,
               None,
               '___sec9'),
              (u' Payback of a loan ', 2, None, '___sec10'),
              (u' How to make a living from a fortune with constant consumption ',
               2,
               None,
               '___sec11'),
              (u' How to make a living from a fortune with inflation-adjusted consumption ',
               2,
               None,
               '___sec12'),
              (u' The mathematics of Fibonacci numbers ',
               2,
               None,
               '___sec13'),
              (u' Program for generating Fibonacci numbers ',
               2,
               None,
               '___sec14'),
              (u' Fibonacci numbers can cause overflow in NumPy arrays ',
               2,
               None,
               '___sec15'),
              (u' No overflow when using Python int types ',
               2,
               None,
               '___sec16'),
              (u" Program with Python's int type for integers ",
               2,
               None,
               '___sec17'),
              (u' New problem setting: exponential growth with limited environmental resources ',
               2,
               None,
               '___sec18'),
              (u' Modeling growth in an environment with limited resources ',
               2,
               None,
               '___sec19'),
              (u' The evolution of logistic growth ', 2, None, '___sec20'),
              (u' The factorial as a difference equation ',
               2,
               None,
               '___sec21'),
              (u' Difference equations must have an initial condition ',
               2,
               None,
               '___sec22'),
              (u' Have you ever though about how $\\sin x$ is really calculated? ',
               2,
               None,
               '___sec23'),
              (u' Would you expect these fantastic mathematical results? ',
               2,
               None,
               '___sec24'),
              (u' Taylor polynomials ', 2, None, '___sec25'),
              (u' Taylor polynomials around an arbitrary point ',
               2,
               None,
               '___sec26'),
              (u' Taylor polynomial as one difference equation ',
               2,
               u'diffeq:Taylor:exp:1',
               u'diffeq:Taylor:exp:1'),
              (u' More efficient computation: the Taylor polynomial as two difference equations ',
               2,
               None,
               '___sec28'),
              (u' Nonlinear algebraic equations ', 2, None, '___sec29'),
              (u" Newton's method for finding zeros ", 2, None, '___sec30'),
              (u" A program for Newton's method ", 2, None, '___sec31'),
              (u" An improved function for Newton's method ",
               2,
               None,
               '___sec32'),
              (u" Application of Newton's method ", 2, None, '___sec33'),
              (u' Results from this test problem ', 2, None, '___sec34'),
              (u' What happened here?? ', 2, None, '___sec35'),
              (u" First step: we're moving to the right ($x=4$?) ",
               2,
               None,
               '___sec36'),
              (u' Second step: oops, too much to the right... ',
               2,
               None,
               '___sec37'),
              (u" Third step: disaster since we're ``done'' ($f(x)\\approx 0$) ",
               2,
               None,
               '___sec38'),
              (u' Programming with sound ', 2, None, '___sec39'),
              (u' Making a sound file with single tone (part 1) ',
               2,
               None,
               '___sec40'),
              (u' Making a sound file with single tone (part 2) ',
               2,
               None,
               '___sec41'),
              (u' Reading sound from file ', 2, None, '___sec42'),
              (u' Playing many notes ', 2, None, '___sec43'),
              (u' Summary of difference equations ', 2, None, '___sec44'),
              (u' Summarizing example: music of sequences ',
               2,
               None,
               '___sec45'),
              (u' Module file: soundeq.py ', 2, None, '___sec46')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- ------------------- main content ---------------------- -->



<center><h1>App. A: Sequences and difference equations</h1></center>  <!-- document title -->

<p>
<!-- author(s): Hans Petter Langtangen -->

<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>


<p>
<!-- institution(s) -->

<center>[1] <b>Simula Research Laboratory</b></center>
<center>[2] <b>University of Oslo, Dept. of Informatics</b></center>
<p>
<center><h4>Sep 24, 2014</h4></center> <!-- date -->
<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Sequences  <a name="___sec0"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<em>Sequences</em> is a central topic in mathematics:

$$ x_0,\ x_1,\ x_2,\ \ldots,\ x_n,\ldots, $$


<p>
Example: all odd numbers

$$ 1, 3, 5, 7, \ldots, 2n+1,\ldots $$


<p>
For this sequence we have a formula for the \( n \)-th term:

$$ x_n = 2n+1 $$

and we can write the sequence more compactly as

$$ (x_n)_{n=0}^\infty,\quad x_n = 2n+1$$
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Other examples of sequences  <a name="___sec1"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
$$ 1,\ 4,\ 9,\ 16,\ 25,\ \ldots\quad (x_n)_{n=0}^\infty,\ x_n=n^2$$


$$ 1,\ {1\over 2},\ {1\over3},\ {1\over4},\ \ldots\quad (x_n)_{n=0}^\infty,\ x_n={1\over {n+1}}$$


$$ 1,\ 1,\ 2,\ 6,\ 24,\ \ldots\quad (x_n)_{n=0}^\infty,\ x_n=n!$$


$$ 1,\ 1+x,\ 1+x+{1\over2}x^2,\ 1+x+{1\over2}x^2+{1\over6}x^3,\ \ldots\quad (x_n)_{n=0}^\infty,\ x_n=\sum_{j=0}^n {x^j\over j!}$$
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Finite and infinite sequences  <a name="___sec2"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Infinite sequences have an infinite number of terms (\( n\rightarrow\infty \))</li>
  <li> In mathematics, infinite sequences are widely used</li>
  <li> In real-life applications, sequences are usually finite: \( (x_n)_{n=0}^N \)</li>
  <li> Example: number of approved exercises every week in INF1100<br />
    \( x_0, x_1, x_2, \ldots, x_{15} \)</li>
  <li> Example: the annual value of a loan<br />
    \( x_0, x_1, \ldots, x_{20} \)</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Difference equations  <a name="___sec3"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> For sequences occuring in modeling of real-world phenomena, there is seldom a formula for the \( n \)-th term</li>
  <li> However, we can often set up one or more equations governing the sequence</li>
  <li> Such equations are called difference equations</li>
  <li> With a computer it is then very easy to generate the sequence by solving the difference equations</li>
  <li> Difference equations have lots of applications and are very easy to solve on a computer, but often complicated or impossible to solve for \( x_n \) (as a formula) by pen and paper!</li>
  <li> The programs require only loops and arrays</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Modeling interest rates  <a name="___sec4"></a></h2>

<p>
<!-- !bpop -->
<div class="alert alert-block alert-block alert-text-normal">
<b>Problem:</b>
<p>
Put \( x_0 \) money in a bank at year 0. What is the value after \( N \) years if the interest rate is \( p \) percent per year?
</div>

<!-- !epop -->

<p>
<!-- !bpop -->
<div class="alert alert-block alert-block alert-text-normal">
<b>Solution:</b>
<p>
The fundamental information relates the value at year \( n \), \( x_n \), to the value of the previous year, \( x_{n-1} \):

$$ x_{n} = x_{n-1} + {p\over 100}x_{n-1} $$


<p>
How to solve for \( x_n \)? Start with \( x_0 \), compute \( x_1 \), \( x_2 \), ...
</div>

<!-- !epop -->

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Simulating the difference equation for interest rates  <a name="___sec5"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>What does it mean to simulate?</b>
<p>
Solve math equations by repeating a simple procedure (relation) many times (boring, but well suited for a computer!)
</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Program for \( x_{n} = x_{n-1} + (p/100)x_{n-1} \):</b>
<p>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">scitools.std</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
x0 <span style="color: #666666">=</span> <span style="color: #666666">100</span>                      <span style="color: #408080; font-style: italic"># initial amount</span>
p <span style="color: #666666">=</span> <span style="color: #666666">5</span>                         <span style="color: #408080; font-style: italic"># interest rate</span>
N <span style="color: #666666">=</span> <span style="color: #666666">4</span>                         <span style="color: #408080; font-style: italic"># number of years</span>
index_set <span style="color: #666666">=</span> <span style="color: #008000">range</span>(N<span style="color: #666666">+1</span>)
x <span style="color: #666666">=</span> zeros(<span style="color: #008000">len</span>(index_set))

<span style="color: #408080; font-style: italic"># Solution:</span>
x[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> x0
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> index_set[<span style="color: #666666">1</span>:]:
    x[n] <span style="color: #666666">=</span> x[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> (p<span style="color: #666666">/100.0</span>)<span style="color: #666666">*</span>x[n<span style="color: #666666">-1</span>]
<span style="color: #008000; font-weight: bold">print</span> x
plot(index_set, x, <span style="color: #BA2121">&#39;ro&#39;</span>, xlabel<span style="color: #666666">=</span><span style="color: #BA2121">&#39;years&#39;</span>, ylabel<span style="color: #666666">=</span><span style="color: #BA2121">&#39;amount&#39;</span>)
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>We do not need to store the entire sequence, but it is convenient for programming and later plotting  <a name="___sec6"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Previous program stores all the \( x_n \) values in a NumPy array</li>
  <li> To compute \( x_n \), we only need one previous value, \( x_{n-1} \)</li>
</ul>

Thus, we could only store the two last values in memory:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">x_old <span style="color: #666666">=</span> x0
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> index_set[<span style="color: #666666">1</span>:]:
    x_new <span style="color: #666666">=</span> x_old <span style="color: #666666">+</span> (p<span style="color: #666666">/100.</span>)<span style="color: #666666">*</span>x_old
    x_old <span style="color: #666666">=</span> x_new  <span style="color: #408080; font-style: italic"># x_new becomes x_old at next step</span>
</pre></div>
<p>
However, programming with an array <code>x[n]</code> is simpler, safer, and enables plotting the sequence, so we will continue to use arrays in the examples
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Daily interest rate  <a name="___sec7"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> A more relevant model is to add the interest every day</li>
  <li> The interest rate per day is \( r=p/D \) if \( p \) is the annual interest rate and \( D \) is the number of days in a year</li>
  <li> A common model in business applies \( D=360 \), but \( n \) counts exact (all) days</li>
</ul>

Just a minor change in the model:

$$x_{n} = x_{n-1} + {r\over 100}x_{n-1}$$


<p>
How can we find the number of days between two dates?

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">datetime</span>
<span style="color: #666666">&gt;&gt;&gt;</span> date1 <span style="color: #666666">=</span> datetime<span style="color: #666666">.</span>date(<span style="color: #666666">2007</span>, <span style="color: #666666">8</span>, <span style="color: #666666">3</span>)  <span style="color: #408080; font-style: italic"># Aug 3, 2007</span>
<span style="color: #666666">&gt;&gt;&gt;</span> date2 <span style="color: #666666">=</span> datetime<span style="color: #666666">.</span>date(<span style="color: #666666">2008</span>, <span style="color: #666666">8</span>, <span style="color: #666666">4</span>)  <span style="color: #408080; font-style: italic"># Aug 4, 2008</span>
<span style="color: #666666">&gt;&gt;&gt;</span> diff <span style="color: #666666">=</span> date2 <span style="color: #666666">-</span> date1
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> diff<span style="color: #666666">.</span>days
<span style="color: #666666">367</span>
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Program for daily interest rate  <a name="___sec8"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">scitools.std</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
x0 <span style="color: #666666">=</span> <span style="color: #666666">100</span>                           <span style="color: #408080; font-style: italic"># initial amount</span>
p <span style="color: #666666">=</span> <span style="color: #666666">5</span>                              <span style="color: #408080; font-style: italic"># annual interest rate</span>
r <span style="color: #666666">=</span> p<span style="color: #666666">/360.0</span>                        <span style="color: #408080; font-style: italic"># daily interest rate</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">datetime</span>
date1 <span style="color: #666666">=</span> datetime<span style="color: #666666">.</span>date(<span style="color: #666666">2007</span>, <span style="color: #666666">8</span>, <span style="color: #666666">3</span>)
date2 <span style="color: #666666">=</span> datetime<span style="color: #666666">.</span>date(<span style="color: #666666">2011</span>, <span style="color: #666666">8</span>, <span style="color: #666666">3</span>)
diff <span style="color: #666666">=</span> date2 <span style="color: #666666">-</span> date1
N <span style="color: #666666">=</span> diff<span style="color: #666666">.</span>days
index_set <span style="color: #666666">=</span> <span style="color: #008000">range</span>(N<span style="color: #666666">+1</span>)
x <span style="color: #666666">=</span> zeros(<span style="color: #008000">len</span>(index_set))

<span style="color: #408080; font-style: italic"># Solution:</span>
x[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> x0
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> index_set[<span style="color: #666666">1</span>:]:
    x[n] <span style="color: #666666">=</span> x[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> (r<span style="color: #666666">/100.0</span>)<span style="color: #666666">*</span>x[n<span style="color: #666666">-1</span>]
<span style="color: #008000; font-weight: bold">print</span> x
plot(index_set, x, <span style="color: #BA2121">&#39;ro&#39;</span>, xlabel<span style="color: #666666">=</span><span style="color: #BA2121">&#39;days&#39;</span>, ylabel<span style="color: #666666">=</span><span style="color: #BA2121">&#39;amount&#39;</span>)
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>But the annual interest rate may change quite often...  <a name="___sec9"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Varying \( p \) means \( p_n \):</b>
<p>

<ul>
  <li> Could not be handled in school (cannot apply \( x_n =x_0(1+\frac{p}{100})^n \))</li>
  <li> A varying \( p \) causes no problems in the program:
    just fill an array <code>p</code> with correct interest rate for day <code>n</code></li>
</ul>

Modified program:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">p <span style="color: #666666">=</span> zeros(<span style="color: #008000">len</span>(index_set))
<span style="color: #408080; font-style: italic"># fill p[n] for n in index_set (might be non-trivial...)</span>

r <span style="color: #666666">=</span> p<span style="color: #666666">/360.0</span>                      <span style="color: #408080; font-style: italic"># daily interest rate</span>
x <span style="color: #666666">=</span> zeros(<span style="color: #008000">len</span>(index_set))

x[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> x0
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> index_set[<span style="color: #666666">1</span>:]:
    x[n] <span style="color: #666666">=</span> x[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> (r[n<span style="color: #666666">-1</span>]<span style="color: #666666">/100.0</span>)<span style="color: #666666">*</span>x[n<span style="color: #666666">-1</span>]
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Payback of a loan  <a name="___sec10"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> A loan \( L \) is paid back with a fixed amount \( L/N \) every month over \( N \) months + the interest rate of the loan</li>
  <li> \( p \): annual interest rate, \( p/12: \) monthly rate</li>
  <li> Let \( x_n \) be the value of the loan at the end of month \( n \)</li>
</ul>

The fundamental relation from one month to the text:

$$ x_n = x_{n-1} + {p\over 12\cdot 100}x_{n-1} -
({p\over 12\cdot 100}x_{n-1} + {L\over N})$$

which simplifies to

$$ x_n = x_{n-1}  - {L\over N}$$


<p>
(\( L/N \) makes the equation <em>nonhomogeneous</em>)
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>How to make a living from a fortune with constant consumption  <a name="___sec11"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> We have a fortune \( F \) invested with an annual interest rate of \( p \) percent</li>
  <li> Every year we plan to consume an amount \( c_n \) (\( n \) counts years)</li>
  <li> Let \( x_n \) be our fortune at year \( n \)</li>
</ul>

A fundamental relation from one year to the other is

$$ x_n = x_{n-1} + {p\over 100}x_{n-1} - c_n $$


<p>
Simplest possibility: keep \( c_n \) constant, but inflation
demands \( c_n \) to increase...
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>How to make a living from a fortune with inflation-adjusted consumption  <a name="___sec12"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Assume \( I \) percent inflation per year</li>
  <li> Start with \( c_0 \) as \( q \) percent of the interest the first year</li>
  <li> \( c_n \) then develops as money with interest rate \( I \)</li>
</ul>

\( x_n \) develops with rate \( p \) but with a loss \( c_n \) every year:

$$
\begin{align*}
x_n &= x_{n-1} + {p\over 100}x_{n-1} - c_{n-1}, \quad x_0=F,\ c_0 = {pq\over 10^4}F\\
c_n &= c_{n-1} + {I\over100}c_{n-1}
\end{align*}
$$


<p>
This is a coupled system of <em>two</em> difference equations, but the programming
is still simple: we update two arrays, first <code>x[n]</code>, then <code>c[n]</code>, inside the loop
(good exercise!)
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>The mathematics of Fibonacci numbers  <a name="___sec13"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
No programming or math course is complete without an example on Fibonacci numbers:

$$ x_n = x_{n-1} + x_{n-2},\quad x_0=1,\ x_1=1$$
</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Mathematical classification.</b>
<p>
This is a <em>homogeneous difference equation of second order</em> (second order means three levels: \( n \), \( n-1 \), \( n-2 \)). This classification is important for mathematical solution technique, but not for simulation in a program.
</div>


<p>
<div class="alert alert-block alert-block alert-text-small">
<b></b>
<p>
Fibonacci derived the sequence by modeling rat populations, but the sequence of numbers has a range of peculiar mathematical properties and has therefore attracted much attention from mathematicians.
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Program for generating Fibonacci numbers  <a name="___sec14"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">N <span style="color: #666666">=</span> <span style="color: #008000">int</span>(sys<span style="color: #666666">.</span>argv[<span style="color: #666666">1</span>])
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros
x <span style="color: #666666">=</span> zeros(N<span style="color: #666666">+1</span>, <span style="color: #008000">int</span>)
x[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">1</span>
x[<span style="color: #666666">1</span>] <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">2</span>, N<span style="color: #666666">+1</span>):
    x[n] <span style="color: #666666">=</span> x[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> x[n<span style="color: #666666">-2</span>]
    <span style="color: #008000; font-weight: bold">print</span> n, x[n]
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Fibonacci numbers can cause overflow in NumPy arrays  <a name="___sec15"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Run the program with \( N=50 \):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">2</span> <span style="color: #666666">2</span>
<span style="color: #666666">3</span> <span style="color: #666666">3</span>
<span style="color: #666666">4</span> <span style="color: #666666">5</span>
<span style="color: #666666">5</span> <span style="color: #666666">8</span>
<span style="color: #666666">6</span> <span style="color: #666666">13</span>
<span style="color: #666666">...</span>
<span style="color: #666666">45</span> <span style="color: #666666">1836311903</span>
<span style="color: #D2413A; font-weight: bold">Warning</span>: overflow encountered <span style="color: #AA22FF; font-weight: bold">in</span> long_scalars
<span style="color: #666666">46</span> <span style="color: #666666">-1323752223</span>
</pre></div>
<p>
Note:

<ul>
 <li> Changing <code>int</code> to <code>long</code> or <code>int64</code> for array elements allows \( N\leq 91 \)</li>
 <li> Can use <code>float96</code> (though \( x_n \) is integer): \( N \leq 23600 \)</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>No overflow when using Python int types  <a name="___sec16"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Best: use Python scalars of type <code>int</code> - these automatically changes to <code>long</code> when overflow in <code>int</code></li>
  <li> The <code>long</code> type in Python has arbitrarily many digits (as many as required in a computation!)</li>
  <li> Note: <code>long</code> for arrays is 64-bit integer (<code>int64</code>), while scalar <code>long</code> in Python is an integer with as &quot;infinitely&quot; many digits</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Program with Python's int type for integers  <a name="___sec17"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
The program now avoids arrays and makes use of three <code>int</code> objects (which automatically changes to <code>long</code> when needed):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sys</span>
N <span style="color: #666666">=</span> <span style="color: #008000">int</span>(sys<span style="color: #666666">.</span>argv[<span style="color: #666666">1</span>])
xnm1 <span style="color: #666666">=</span> <span style="color: #666666">1</span>                           <span style="color: #408080; font-style: italic"># &quot;x_n minus 1&quot;</span>
xnm2 <span style="color: #666666">=</span> <span style="color: #666666">1</span>                           <span style="color: #408080; font-style: italic"># &quot;x_n minus 2&quot;</span>
n <span style="color: #666666">=</span> <span style="color: #666666">2</span>
<span style="color: #008000; font-weight: bold">while</span> n <span style="color: #666666">&lt;=</span> N:
    xn <span style="color: #666666">=</span> xnm1 <span style="color: #666666">+</span> xnm2
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;x_</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121"> = </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (n, xn)
    xnm2 <span style="color: #666666">=</span> xnm1
    xnm1 <span style="color: #666666">=</span> xn
    n <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
</pre></div>
<p>
Run with \( N=200 \):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">x_2 <span style="color: #666666">=</span> <span style="color: #666666">2</span>
x_3 <span style="color: #666666">=</span> <span style="color: #666666">3</span>
<span style="color: #666666">...</span>
x_198 <span style="color: #666666">=</span> <span style="color: #666666">173402521172797813159685037284371942044301</span>
x_199 <span style="color: #666666">=</span> <span style="color: #666666">280571172992510140037611932413038677189525</span>
x_200 <span style="color: #666666">=</span> <span style="color: #666666">453973694165307953197296969697410619233826</span>
</pre></div>
<p>
Limition: your computer's memory
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>New problem setting: exponential growth with limited environmental resources  <a name="___sec18"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
The model for growth of money in a bank has a solution of the type

$$ x_n = x_0C^n \quad (= x_0e^{n\ln C})$$


<p>
Note:

<ul>
 <li> This is exponential growth in time (\( n \))</li>
 <li> Populations of humans, animals, and cells also exhibit the same type of growth as long as there are unlimited resources (space and food)</li>
 <li> Most environments can only support a maximum number \( M \) of individuals</li>
 <li> How can we model this limitation?</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Modeling growth in an environment with limited resources  <a name="___sec19"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Initially, when there are enough resources, the growth is exponential:

$$ x_n = x_{n-1} + {r\over 100}x_{n-1}$$


<p>
The growth rate \( r \) must decay to zero as \( x_n \) approaches \( M \). The simplest
variation of \( r(n) \) is a linear:

$$   r(n) = \varrho \left(1 - {x_n\over M}\right) $$


<p>
Observe: \( r(n)\approx \varrho \) for small \( n \) when \( x_n\ll M \), and
\( r(n) \rightarrow 0 \) as \( x_n\rightarrow M \) and \( n \) is big
</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Logistic growth model:</b>
<p>
$$ x_n = x_{n-1} + {\varrho\over 100} x_{n-1}\left(1 - {x_{n-1}\over M}\right)$$

(This is a <em>nonlinear</em> difference equation)
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>The evolution of logistic growth  <a name="___sec20"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
In a program it is easy to introduce logistic instead of exponential growth, just replace

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">x[n] <span style="color: #666666">=</span> x[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> p<span style="color: #666666">/100.0</span>)<span style="color: #666666">*</span>x[n<span style="color: #666666">-1</span>]
</pre></div>
<p>
by

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">x[n] <span style="color: #666666">=</span> x[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> (rho<span style="color: #666666">/100.0</span>)<span style="color: #666666">*</span>x[n<span style="color: #666666">-1</span>]<span style="color: #666666">*</span>(<span style="color: #666666">1</span> <span style="color: #666666">-</span> x[n<span style="color: #666666">-1</span>]<span style="color: #666666">/</span><span style="color: #008000">float</span>(M))
</pre></div>

</div>


<p>
<center><p><img src="fig-diffeq/logistic_growth1.png" align="bottom" width=400></p></center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>The factorial as a difference equation  <a name="___sec21"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
The factorial \( n! \) is defined as

$$ n(n-1)(n-2)\cdots 1,\quad 0!=1$$


<p>
The following difference equation has \( x_n=n! \) as solution and can be used to compute the factorial:

$$ x_n = nx_{n-1},\quad x_0 = 1 $$
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Difference equations must have an initial condition  <a name="___sec22"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
 <li> In mathematics, it is much stressed that a difference equation for
   \( x_n \) must have an initial condition \( x_0 \)</li>
 <li> The initial condition is obvious when programming: otherwise we cannot
   start the program (\( x_0 \) is needed to compute \( x_n \))</li>
 <li> However: if you forget <code>x[0] = x0</code> in the program, you get \( x_0=0 \)
   (because <code>x = zeroes(N+1)</code>),
   which (usually) gives unintended results!</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Have you ever though about how \( \sin x \) is really calculated?  <a name="___sec23"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
 <li> How can you <em>calculate</em> \( \sin x \), \( \ln x \), \( e^x \) without a calculator
   or program?</li>
 <li> These functions were originally defined to have some desired mathematical
   properties, but without an algorithm for how to evaluate function values</li>
 <li> Idea: approximate \( \sin x \), etc. by polynomials, since they are easy
   to calculate (sum, multiplication), but how??</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Would you expect these fantastic mathematical results?  <a name="___sec24"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Amazing result by Gregory, 1667:</b>
<p>
$$ \sin x = \sum_{k=0}^\infty (-1)^k\frac{x^{2k+1}}{(2k+1)!}$$
</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Even more amazing result by Taylor, 1715:</b>
<p>
$$ f(x) = \sum_{k=0}^\infty \frac{1}{k!}(\frac{d^k}{dx^k} f(0))x^k $$

For &quot;any&quot; \( f(x) \), if we can differentiate, add, and multiply \( x^k \),
we can evaluate \( f \) at any \( x \) (!!!)
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Taylor polynomials  <a name="___sec25"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Practical applications works with a truncated sum:</b>
<p>
$$ f(x) \approx \sum_{k=0}^{{\color{red} N}}
\frac{1}{k!}(\frac{d^k}{dx^k} f(0))x^k $$


<p>
\( N=1 \) is <em>very</em> popular and has been essential in developing
physics and technology
</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Example:</b>
<p>
$$
\begin{align*}
e^x &= \sum_{k=0}^\infty \frac{x^k}{k!}\\
&\approx 1 + x + \frac{1}{2}x^2 + \frac{1}{6}x^3\\
&\approx 1 + x
\end{align*}
$$
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Taylor polynomials around an arbitrary point  <a name="___sec26"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
The previous Taylor polynomials are most accurate around \( x=0 \). Can
make the polynomials accurate around any point \( x=a \):

$$ f(x) \approx \sum_{k=0}^N \frac{1}{k!}(\frac{d^k}{dx^k} f(a))(x-a)^k $$
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Taylor polynomial as one difference equation <a name="diffeq:Taylor:exp:1"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
The Taylor series for \( e^x \) around \( x=0 \) reads

$$  e^x= \sum_{n=0}^\infty {x^n\over n!} $$


<p>
Define

$$ e_{n}=\sum_{k=0}^{n-1} \frac{x^k}{k!} =
\sum_{k=0}^{n-2} \frac{x^k}{k!} + \frac{x^{n-1}}{(n-1)!}$$


<p>
We can formulate the sum in \( e_n \) as the following difference equation:

$$ e_n = e_{n-1} + \frac{x^{n-1}}{(n-1)!},\quad e_0=0 $$
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>More efficient computation: the Taylor polynomial as two difference equations  <a name="___sec28"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Observe:

$$ \frac{x^n}{n!} = \frac{x^{n-1}}{(n-1)!}\cdot \frac{x}{n} $$


<p>
Let \( a_n = x^n/n! \). Then we can efficiently compute \( a_n \) via

$$ a_n = a_{n-1}\frac{x}{n},\quad a_0 = 1$$


<p>
Now we can update each term via the \( a_n \) equation and sum the terms via
the \( e_n \) equation:

$$
\begin{align*}
e_n &= e_{n-1} + a_{n-1},\quad e_0 = 0,\ a_0 = 1\\
a_n &= {x\over n} a_{n-1}
\end{align*}
$$


<p>
See the book for more details
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Nonlinear algebraic equations  <a name="___sec29"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Generic form of any (algebraic) equation in \( x \):</b>
<p>
\[ f(x)=0 \]
</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Examples that can be solved by hand:</b>
<p>
          \[ ax + b = 0 \]
          \[ ax^2 + bx + c = 0 \]
          \[ \sin x + \cos x = 1 \]
</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Simple numerical algorithms can solve &quot;any&quot; equation \( f(x)=0 \)</li>
  <li> Safest: Bisection</li>
  <li> Fastest: Newton's method</li>
  <li> Don't like \( f'(x) \) in Newton's method? Use the Secant method</li>
  <li> Secant and Newton are difference equations!</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Newton's method for finding zeros  <a name="___sec30"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Newton's method.</b>
<p>
Simpson (1740) came up with the following general
method for solving \( f(x)=0 \) (based on ideas by Newton):

$$
x_n = x_{n-1} - {f(x_{n-1})\over f'(x_{n-1})},\quad x_0 \hbox{ given}
$$


<p>
Note:

<ul>
  <li> This is a (nonlinear!) difference equation</li>
  <li> As \( n\rightarrow\infty \), we hope that \( x_n\rightarrow x_s \), where \( x_s \) solves \( f(x_s)=0 \)</li>
  <li> How to choose \( N \) when what we want is \( x_N \) close to \( x_s \)?</li>
  <li> Need a slightly different program: simulate until \( f(x)\leq \epsilon \), where \( \epsilon \) is a small tolerance</li>
  <li> Caution: Newton's method may (easily) diverge, so \( f(x)\leq\epsilon \) may
    never occur!</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>A program for Newton's method  <a name="___sec31"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Quick implementation:</b>
<p>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">Newton</span>(f, x, dfdx, epsilon<span style="color: #666666">=1.0E-7</span>, max_n<span style="color: #666666">=100</span>):
    n <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    <span style="color: #008000; font-weight: bold">while</span> <span style="color: #008000">abs</span>(f(x)) <span style="color: #666666">&gt;</span> epsilon <span style="color: #AA22FF; font-weight: bold">and</span> n <span style="color: #666666">&lt;=</span> max_n:
        x <span style="color: #666666">=</span> x <span style="color: #666666">-</span> f(x)<span style="color: #666666">/</span>dfdx(x)
        n <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">return</span> x, n, f(x)
</pre></div>
<p>
Note:

<ul>
  <li> \( f(x) \) is evaluated twice in each pass of the loop - only one evaluation is strictly necessary (can store the value in a variable and reuse it)</li>
  <li> <code>f(x)/dfdx(x)</code> can give integer division</li>
  <li> It could be handy to store the <code>x</code> and <code>f(x)</code> values in each iteration (for plotting or printing a convergence table)</li>
</ul>
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>An improved function for Newton's method  <a name="___sec32"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Only one \( f(x) \) call in each iteration, optional storage of \( (x,f(x)) \) values during the iterations, and ensured float division:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">Newton</span>(f, x, dfdx, epsilon<span style="color: #666666">=1.0E-7</span>, max_n<span style="color: #666666">=100</span>,
           store<span style="color: #666666">=</span><span style="color: #008000">False</span>):
    f_value <span style="color: #666666">=</span> f(x)
    n <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    <span style="color: #008000; font-weight: bold">if</span> store: info <span style="color: #666666">=</span> [(x, f_value)]
    <span style="color: #008000; font-weight: bold">while</span> <span style="color: #008000">abs</span>(f_value) <span style="color: #666666">&gt;</span> epsilon <span style="color: #AA22FF; font-weight: bold">and</span> n <span style="color: #666666">&lt;=</span> max_n:
        x <span style="color: #666666">=</span> x <span style="color: #666666">-</span> <span style="color: #008000">float</span>(f_value)<span style="color: #666666">/</span>dfdx(x)
        n <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
        f_value <span style="color: #666666">=</span> f(x)
        <span style="color: #008000; font-weight: bold">if</span> store: info<span style="color: #666666">.</span>append((x, f_value))
    <span style="color: #008000; font-weight: bold">if</span> store:
        <span style="color: #008000; font-weight: bold">return</span> x, info
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">return</span> x, n, f_value
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Application of Newton's method  <a name="___sec33"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
$$ e^{-0.1x^2}\sin ({\pi\over 2}x) =0\]

Solutions: $x=0, \pm 2, \pm 4, \pm 6, \ldots$
$$
</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Main program:</b>
<p>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> sin, cos, exp, pi
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sys</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">g</span>(x):
    <span style="color: #008000; font-weight: bold">return</span> exp(<span style="color: #666666">-0.1*</span>x<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>sin(pi<span style="color: #666666">/2*</span>x)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">dg</span>(x):
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">-2*0.1*</span>x<span style="color: #666666">*</span>exp(<span style="color: #666666">-0.1*</span>x<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>sin(pi<span style="color: #666666">/2*</span>x) <span style="color: #666666">+</span> \
           pi<span style="color: #666666">/2*</span>exp(<span style="color: #666666">-0.1*</span>x<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>cos(pi<span style="color: #666666">/2*</span>x)

x0 <span style="color: #666666">=</span> <span style="color: #008000">float</span>(sys<span style="color: #666666">.</span>argv[<span style="color: #666666">1</span>])
x, info <span style="color: #666666">=</span> Newton(g, x0, dg, store<span style="color: #666666">=</span><span style="color: #008000">True</span>)
<span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Computed zero:&#39;</span>, x

<span style="color: #408080; font-style: italic"># Print the evolution of the difference equation</span>
<span style="color: #408080; font-style: italic"># (i.e., the search for the root)</span>
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(info)):
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Iteration </span><span style="color: #BB6688; font-weight: bold">%3d</span><span style="color: #BA2121">: f(</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">)=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (i, info[i][<span style="color: #666666">0</span>], info[i][<span style="color: #666666">1</span>])
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Results from this test problem  <a name="___sec34"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
\( x_0=1.7 \) gives quick convergence towards the closest root \( x=0 \):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">zero: <span style="color: #666666">1.999999999768449</span>
Iteration  <span style="color: #666666">0</span>: f(<span style="color: #666666">1.7</span>)<span style="color: #666666">=0.340044</span>
Iteration  <span style="color: #666666">1</span>: f(<span style="color: #666666">1.99215</span>)<span style="color: #666666">=0.00828786</span>
Iteration  <span style="color: #666666">2</span>: f(<span style="color: #666666">1.99998</span>)<span style="color: #666666">=2.53347e-05</span>
Iteration  <span style="color: #666666">3</span>: f(<span style="color: #666666">2</span>)<span style="color: #666666">=2.43808e-10</span>
</pre></div>
<p>
Start value \( x_0=3 \) (closest root \( x=2 \) or \( x=4 \)):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">zero: <span style="color: #666666">42.49723316011362</span>
Iteration  <span style="color: #666666">0</span>: f(<span style="color: #666666">3</span>)<span style="color: #666666">=-0.40657</span>
Iteration  <span style="color: #666666">1</span>: f(<span style="color: #666666">4.66667</span>)<span style="color: #666666">=0.0981146</span>
Iteration  <span style="color: #666666">2</span>: f(<span style="color: #666666">42.4972</span>)<span style="color: #666666">=-2.59037e-79</span>
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>What happened here??  <a name="___sec35"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Try the demo program <code>src/diffeq/Newton_movie.py</code> with \( x_0=3 \),
\( x\in [-2,50] \) for plotting and numerical approximation of \( f'(x) \):

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python Newton_movie.py &quot;exp(-0.1*x**2)*sin(pi/2*x)&quot; \
          numeric 3 -2 50
</pre></div>

</div>


<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Lesson learned:</b>
<p>
Newton's method may work fine or give wrong results! You need to understand the method to interpret the results!
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>First step: we're moving to the right (\( x=4 \)?)  <a name="___sec36"></a></h2>

<p>
<center><p><img src="fig-diffeq/Newton_demo_divergence_0000.png" align="bottom" width=600></p></center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Second step: oops, too much to the right...  <a name="___sec37"></a></h2>

<p>
<center><p><img src="fig-diffeq/Newton_demo_divergence_0001.png" align="bottom" width=600></p></center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Third step: disaster since we're &quot;done&quot; (\( f(x)\approx 0 \))  <a name="___sec38"></a></h2>

<p>
<center><p><img src="fig-diffeq/Newton_demo_divergence_0002.png" align="bottom" width=600></p></center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Programming with sound  <a name="___sec39"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Tones are sine waves:</b>
<p>
A tone <b>A</b> (440 Hz) is a sine wave with frequency 440 Hz:

$$ s(t) = A\sin\left( 2\pi f t\right),\quad f = 440 $$


<p>
On a computer we represent \( s(t) \) by a discrete set of points on the function curve (exactly as we do when we plot \( s(t) \)).
CD quality needs 44100 samples per second.
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Making a sound file with single tone (part 1)  <a name="___sec40"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> \( r \): sampling rate (samples per second, default 44100)</li>
  <li> \( f \): frequency of the tone</li>
  <li> \( m \): duration of the tone (seconds)</li>
</ul>

Sampled sine function for this tone:

$$ s_n =
A\sin\left( 2\pi f {n\over r}\right),
\quad n=0,1,\ldots, m\cdot r
$$


<p>
Code (we use descriptive names: <code>frequency</code> \( f \), <code>length</code> \( m \), <code>amplitude</code> \( A \), <code>sample_rate</code> \( r \)):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">note</span>(frequency, length, amplitude<span style="color: #666666">=1</span>,
         sample_rate<span style="color: #666666">=44100</span>):
    time_points <span style="color: #666666">=</span> numpy<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, length,
                                 length<span style="color: #666666">*</span>sample_rate)
    data <span style="color: #666666">=</span> numpy<span style="color: #666666">.</span>sin(<span style="color: #666666">2*</span>numpy<span style="color: #666666">.</span>pi<span style="color: #666666">*</span>frequency<span style="color: #666666">*</span>time_points)
    data <span style="color: #666666">=</span> amplitude<span style="color: #666666">*</span>data
    <span style="color: #008000; font-weight: bold">return</span> data
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Making a sound file with single tone (part 2)  <a name="___sec41"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> We have <code>data</code> as an array with <code>float</code> and unit amplitude</li>
  <li> Sound data in a file should have 2-byte integers (<code>int16</code>) as data elements and amplitudes up to \( 2^{15}-1 \) (max value for <code>int16</code> data)</li>
</ul>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">data <span style="color: #666666">=</span> note(<span style="color: #666666">440</span>, <span style="color: #666666">2</span>)
data <span style="color: #666666">=</span> data<span style="color: #666666">.</span>astype(numpy<span style="color: #666666">.</span>int16)
max_amplitude <span style="color: #666666">=</span> <span style="color: #666666">2**15</span> <span style="color: #666666">-</span> <span style="color: #666666">1</span>
data <span style="color: #666666">=</span> max_amplitude<span style="color: #666666">*</span>data
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">scitools.sound</span>
scitools<span style="color: #666666">.</span>sound<span style="color: #666666">.</span>write(data, <span style="color: #BA2121">&#39;Atone.wav&#39;</span>)
scitools<span style="color: #666666">.</span>sound<span style="color: #666666">.</span>play(<span style="color: #BA2121">&#39;Atone.wav&#39;</span>)
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Reading sound from file  <a name="___sec42"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Let us read a sound file and add echo</li>
  <li> Sound = array <code>s[n]</code></li>
  <li> Echo means to add a delay of the sound</li>
</ul>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># echo: e[n] = beta*s[n] + (1-beta)*s[n-b]</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add_echo</span>(data, beta<span style="color: #666666">=0.8</span>, delay<span style="color: #666666">=0.002</span>,
             sample_rate<span style="color: #666666">=44100</span>):
    newdata <span style="color: #666666">=</span> data<span style="color: #666666">.</span>copy()
    shift <span style="color: #666666">=</span> <span style="color: #008000">int</span>(delay<span style="color: #666666">*</span>sample_rate)  <span style="color: #408080; font-style: italic"># b (math symbol)</span>
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">xrange</span>(shift, <span style="color: #008000">len</span>(data)):
        newdata[i] <span style="color: #666666">=</span> beta<span style="color: #666666">*</span>data[i] <span style="color: #666666">+</span> (<span style="color: #666666">1-</span>beta)<span style="color: #666666">*</span>data[i<span style="color: #666666">-</span>shift]
    <span style="color: #008000; font-weight: bold">return</span> newdata
</pre></div>
<p>
Load data, add echo and play:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">data <span style="color: #666666">=</span> scitools<span style="color: #666666">.</span>sound<span style="color: #666666">.</span>read(filename)
data <span style="color: #666666">=</span> data<span style="color: #666666">.</span>astype(<span style="color: #008000">float</span>)
data <span style="color: #666666">=</span> add_echo(data, beta<span style="color: #666666">=0.6</span>)
data <span style="color: #666666">=</span> data<span style="color: #666666">.</span>astype(int16)
scitools<span style="color: #666666">.</span>sound<span style="color: #666666">.</span>play(data)
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Playing many notes  <a name="___sec43"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Each note is an array of samples from a sine with a frequency corresponding to the note</li>
  <li> Assume we have several note arrays <code>data1</code>, <code>data2</code>, ...:</li>
</ul>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># put data1, data2, ... after each other in a new array:</span>
data <span style="color: #666666">=</span> numpy<span style="color: #666666">.</span>concatenate((data1, data2, data3, <span style="color: #666666">...</span>))
</pre></div>
<p>
The start of "Nothing Else Matters" (Metallica):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">E1 <span style="color: #666666">=</span> note(<span style="color: #666666">164.81</span>, <span style="color: #666666">.5</span>)
G <span style="color: #666666">=</span> note(<span style="color: #666666">392</span>, <span style="color: #666666">.5</span>)
B <span style="color: #666666">=</span> note(<span style="color: #666666">493.88</span>, <span style="color: #666666">.5</span>)
E2 <span style="color: #666666">=</span> note(<span style="color: #666666">659.26</span>, <span style="color: #666666">.5</span>)
intro <span style="color: #666666">=</span> numpy<span style="color: #666666">.</span>concatenate((E1, G, B, E2, B, G))
<span style="color: #666666">...</span>
song <span style="color: #666666">=</span> numpy<span style="color: #666666">.</span>concatenate((intro, intro, <span style="color: #666666">...</span>))
scitools<span style="color: #666666">.</span>sound<span style="color: #666666">.</span>play(song)
scitools<span style="color: #666666">.</span>sound<span style="color: #666666">.</span>write(song, <span style="color: #BA2121">&#39;tmp.wav&#39;</span>)
</pre></div>

</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Summary of difference equations  <a name="___sec44"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Sequence: \( x_0 \), \( x_1 \), \( x_2 \), \( \ldots \), \( x_n \), \( \ldots \), \( x_N \)</li>
  <li> Difference equation: relation between \( x_n \), \( x_{n-1} \) and maybe \( x_{n-2} \) (or more terms in the "past")  + known start value \( x_0 \) (and more values \( x_1 \), ... if more levels enter the equation)</li>
</ul>

Solution of difference equations by simulation:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">index_set <span style="color: #666666">=</span> <span style="color: #666666">&lt;</span>array of n<span style="color: #666666">-</span>values: <span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">...</span>, N<span style="color: #666666">&gt;</span>
x <span style="color: #666666">=</span> zeros(N<span style="color: #666666">+1</span>)
x[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> x0
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> index_set[<span style="color: #666666">1</span>:]:
    x[n] <span style="color: #666666">=</span> <span style="color: #666666">&lt;</span>formula involving x[n<span style="color: #666666">-1</span>]<span style="color: #666666">&gt;</span>
</pre></div>
<p>
Can have (simple) systems of difference equations:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> index_set[<span style="color: #666666">1</span>:]:
    x[n] <span style="color: #666666">=</span> <span style="color: #666666">&lt;</span>formula involving x[n<span style="color: #666666">-1</span>]<span style="color: #666666">&gt;</span>
    y[n] <span style="color: #666666">=</span> <span style="color: #666666">&lt;</span>formula involving y[n<span style="color: #666666">-1</span>] <span style="color: #AA22FF; font-weight: bold">and</span> x[n]<span style="color: #666666">&gt;</span>
</pre></div>
<p>
Taylor series and numerical methods such as Newton's method can be formulated as difference equations, often resulting in a good way of programming the formulas
</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Summarizing example: music of sequences  <a name="___sec45"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
  <li> Given a \( x_0 \), \( x_1 \), \( x_2 \), \( \ldots \), \( x_n \), \( \ldots \), \( x_N \)</li>
  <li> Can we listen to this sequence as "music"?</li>
  <li> Yes, we just transform the \( x_n \) values to suitable frequencies and use the functions in <code>scitools.sound</code> to generate tones</li>
</ul>

We will study two sequences:

$$ x_n = e^{-4n/N}\sin(8\pi n/N)$$

and

$$ x_n = x_{n-1} + q x_{n-1}\left(1 - x_{n-1}\right),\quad x = x_0 $$


<p>
The first has values in \( [-1,1] \), the other from \( x_0=0.01 \) up to around 1

<p>
Transformation from "unit" \( x_n \) to frequencies:

$$ y_n = 440 + 200 x_n $$

(first sequence then gives tones between 240 Hz and 640 Hz)


</div>


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Module file: soundeq.py  <a name="___sec46"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<ul>
 <li> Three functions: two for generating sequences, one for the sound</li>
 <li> Look at <code>files/soundeq.py</code> for complete code</li>
</ul>

Try it out in these examples:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python soundseq.py oscillations 40
Terminal&gt; python soundseq.py logistic 100
</pre></div>
<p>
Try to change the frequency range from 200 to 400.
</div>


<!-- ------------------- end of main content --------------- -->


</body>
</html>
    

